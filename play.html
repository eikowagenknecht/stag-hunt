<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stag Hunt - Play</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body class="play-mode">
    <div class="container">
      <!-- Setup Screen -->
      <div id="setup-screen" class="screen">
        <header>
          <h1>Stag Hunt Game</h1>
          <p>Will you cooperate to hunt the stag, or play it safe with the hare? Test trust and strategy against another player as you navigate uncertainty and risk together. You can also explore different strategies in <a href="index.html">simulation mode</a>.</p>
        </header>

        <section class="setup">
          <h2>Player Names</h2>

          <div class="input-group">
            <label for="player1-name">Player 1 Name</label>
            <input type="text" id="player1-name" placeholder="Player 1" />
          </div>

          <div class="input-group">
            <label for="player2-name">Player 2 Name</label>
            <input type="text" id="player2-name" placeholder="Player 2" />
          </div>
        </section>

        <button id="toggle-advanced-settings" class="btn-toggle-settings">
          <span id="advanced-settings-toggle-icon">‚ñ∂</span> Advanced Settings
        </button>

        <section id="advanced-settings-content" class="setup" style="display: none;">
            <div class="preset-group-inline">
              <label for="setup-preset-select">Preset:</label>
              <select id="setup-preset-select" class="preset-select-inline">
                <option value="custom">Custom</option>
                <option value="safe-world">Safe World</option>
                <option value="harsh-world-high">Harsh World - High Resource</option>
                <option value="harsh-world-low">Harsh World - Low Resource</option>
                <option value="ea-dilemma">EA Dilemma</option>
              </select>
              <span class="preset-description-inline" id="setup-preset-description">Set your own parameters</span>
            </div>

            <div class="control-group">
              <label for="setup-starting-food">Starting Food</label>
              <input
                type="range"
                id="setup-starting-food"
                min="0"
                max="20"
                value="5"
                step="1"
              />
              <span id="setup-starting-food-value">5</span>
            </div>

            <div class="control-group">
              <label for="setup-stag-prob">Stag Appearance Probability</label>
              <input
                type="range"
                id="setup-stag-prob"
                min="0"
                max="100"
                value="70"
                step="5"
              />
              <span id="setup-stag-prob-value">70%</span>
            </div>

            <div class="control-group">
              <label for="setup-stag-payoff">Stag Payoff (Successful Hunt)</label>
              <input
                type="range"
                id="setup-stag-payoff"
                min="1"
                max="10"
                value="5"
                step="0.5"
              />
              <span id="setup-stag-payoff-value">5</span>
            </div>

            <div class="control-group">
              <label for="setup-daily-cons">Daily Food Consumption</label>
              <input
                type="range"
                id="setup-daily-cons"
                min="0"
                max="5"
                value="1"
                step="0.5"
              />
              <span id="setup-daily-cons-value">1</span>
            </div>

            <div class="control-group">
              <label for="setup-max-rounds">Maximum Rounds</label>
              <input
                type="range"
                id="setup-max-rounds"
                min="1"
                max="50"
                value="20"
                step="1"
              />
              <span id="setup-max-rounds-value">20</span>
            </div>
        </section>

        <button id="start-game" class="btn btn-primary btn-large">Start Game</button>
      </div>

      <!-- Game Screen (Metrics Dashboard) -->
      <div id="game-screen" class="screen" style="display: none">
        <div class="metrics-dashboard">
          <h2>Round <span id="metrics-round">0</span></h2>

          <div class="metrics-grid">
            <div class="metric-card player1">
              <div class="player-name" id="metrics-player1-name">Player 1</div>
              <div class="food-amount">
                <span id="metrics-player1-food">5</span> food
              </div>
            </div>

            <div class="metric-card player2">
              <div class="player-name" id="metrics-player2-name">Player 2</div>
              <div class="food-amount">
                <span id="metrics-player2-food">5</span> food
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Choice Screen -->
      <div id="choice-screen" class="screen fullscreen-choice" style="display: none">
        <div class="choice-prompt">
          <div class="current-player-banner">
            <span id="current-player-name">Player</span>
          </div>

          <div class="game-state-info">
            <div class="info-item">
              <span class="info-label">Your Food:</span>
              <span class="info-value" id="choice-current-food">5</span>
            </div>
            <div class="info-item" id="choice-daily-consumption-container">
              <span class="info-label">Daily Consumption:</span>
              <span class="info-value" id="choice-daily-consumption">1</span>
            </div>
          </div>

          <p class="privacy-notice">Make your choice - it will be hidden from the other player</p>

          <div class="choice-buttons">
            <button id="choice-stag" class="btn btn-choice btn-stag">
              <span class="icon">ü¶å</span>
              <span class="label">Hunt Stag</span>
              <span class="desc" id="stag-desc-line1">Both Stag: +5 each (70% chance, EV: +3.5)</span>
              <span class="desc" id="stag-desc-line2">You Stag, They Hare: 0</span>
            </button>

            <button id="choice-hare" class="btn btn-choice btn-hare">
              <span class="icon">üêá</span>
              <span class="label">Hunt Hare</span>
              <span class="desc">Both Hare: +2 each</span>
              <span class="desc">You Hare, They Stag: +4</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Transition Screen -->
      <div id="transition-screen" class="screen fullscreen-transition" style="display: none">
        <div class="transition-prompt">
          <h2>Pass phone to <span id="transition-player-name">Player 2</span></h2>
          <p>When ready, they should press the button below</p>
          <button id="ready-button" class="btn btn-primary btn-large">I'm Ready</button>
        </div>
      </div>

      <!-- Reveal Screen -->
      <div id="reveal-screen" class="screen fullscreen-transition" style="display: none">
        <div class="transition-prompt">
          <h2>Both choices are locked in!</h2>
          <p>When both players are ready to see the results, press the button below</p>
          <button id="reveal-button" class="btn btn-primary btn-large">Show Results</button>
        </div>
      </div>

      <!-- Outcome Screen -->
      <div id="outcome-screen" class="screen" style="display: none">
        <div id="outcome-text" class="outcome-content"></div>
        <div class="outcome-chart-container">
          <canvas id="outcome-chart"></canvas>
        </div>
        <div class="round-history-section">
          <button id="toggle-history" class="btn-toggle-history">
            <span id="history-toggle-icon">‚ñ∂</span> Round History
          </button>
          <div id="round-history-content" class="round-history-content" style="display: none;">
            <table id="history-table">
              <thead>
                <tr>
                  <th>Round</th>
                  <th>P1 Choice</th>
                  <th>P2 Choice</th>
                  <th>Stag?</th>
                  <th>P1 Change</th>
                  <th>P2 Change</th>
                  <th>P1 Food</th>
                  <th>P2 Food</th>
                </tr>
              </thead>
              <tbody id="history-table-body">
              </tbody>
            </table>
          </div>
        </div>
        <button id="continue-button" class="btn btn-primary btn-large">
          Continue to Next Round
        </button>
      </div>

      <!-- Game Over Screen -->
      <div id="game-over-screen" class="screen" style="display: none">
        <div id="game-over-text" class="game-over-content"></div>
        <button id="play-again-button" class="btn btn-primary btn-large">
          Play Again
        </button>
      </div>
    </div>

    <script type="module" src="/src/play.ts"></script>
  </body>
</html>
